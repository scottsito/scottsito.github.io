data:text/html;base64,PHNjcmlwdD4NCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCAoKSA9PiB7DQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogIC8vIFNldHVwIGNvbnRhaW5lciBhbmQgYnV0dG9uDQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogIGRvY3VtZW50LmJvZHkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiMwMDAiOw0KICBkb2N1bWVudC5ib2R5LnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7DQogIGRvY3VtZW50LmJvZHkuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAiY2VudGVyIjsNCiAgZG9jdW1lbnQuYm9keS5zdHlsZS5hbGlnbkl0ZW1zID0gImNlbnRlciI7DQogIGRvY3VtZW50LmJvZHkuc3R5bGUuaGVpZ2h0ID0gIjEwMHZoIjsNCiAgZG9jdW1lbnQuYm9keS5zdHlsZS5tYXJnaW4gPSAiMCI7DQogIGRvY3VtZW50LmJvZHkuc3R5bGUuZmxleERpcmVjdGlvbiA9ICJjb2x1bW4iOw0KICBkb2N1bWVudC5ib2R5LnN0eWxlLmZvbnRGYW1pbHkgPSAic2Fucy1zZXJpZiI7DQogIGRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZyA9ICIyNHB4IjsNCiAgZG9jdW1lbnQuYm9keS5zdHlsZS5ib3hTaXppbmcgPSAiYm9yZGVyLWJveCI7DQoNCiAgY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOw0KICBwbGF5QnRuLnRleHRDb250ZW50ID0gIlBsYXkiOw0KICBwbGF5QnRuLnN0eWxlLmNzc1RleHQgPSBgDQogICAgcGFkZGluZzoxLjVyZW0gM3JlbTsNCiAgICBmb250LXNpemU6MnJlbTsNCiAgICBmb250LXdlaWdodDpib2xkOw0KICAgIGNvbG9yOndoaXRlOw0KICAgIGJhY2tncm91bmQtY29sb3I6IzI4YTc0NTsNCiAgICBib3JkZXI6bm9uZTsNCiAgICBib3JkZXItcmFkaXVzOjIwcHg7DQogICAgY3Vyc29yOnBvaW50ZXI7DQogICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMnMsIGJhY2tncm91bmQtY29sb3IgMC4yczsNCiAgYDsNCiAgcGxheUJ0bi5vbm1vdXNlb3ZlciA9ICgpID0+IHsNCiAgICBwbGF5QnRuLnN0eWxlLnRyYW5zZm9ybSA9ICJzY2FsZSgxLjA1KSI7DQogICAgcGxheUJ0bi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIzIxODgzOCI7DQogIH07DQogIHBsYXlCdG4ub25tb3VzZW91dCA9ICgpID0+IHsNCiAgICBwbGF5QnRuLnN0eWxlLnRyYW5zZm9ybSA9ICJzY2FsZSgxKSI7DQogICAgcGxheUJ0bi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIzI4YTc0NSI7DQogIH07DQoNCiAgY29uc3Qgc3RhdHVzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogIHN0YXR1cy5zdHlsZS5jc3NUZXh0ID0NCiAgICAibWFyZ2luLXRvcDoxNnB4OyBmb250LXNpemU6MXJlbTsgY29sb3I6I2NjYzsgdGV4dC1hbGlnbjpjZW50ZXI7IG1heC13aWR0aDo5MDBweDsiOw0KDQogIC8vIFByb2dyZXNzIFVJIGNvbnRhaW5lcg0KICBjb25zdCBwcm9nV3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICBwcm9nV3JhcC5zdHlsZS5jc3NUZXh0ID0NCiAgICAid2lkdGg6bWluKDkwMHB4LCA5NXZ3KTsgbWFyZ2luLXRvcDoxOHB4OyBjb2xvcjojZGRkOyBmb250LXNpemU6MC45NXJlbTsgZGlzcGxheTpub25lOyI7DQoNCiAgY29uc3Qgb3ZlcmFsbExhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogIG92ZXJhbGxMYWJlbC5zdHlsZS5jc3NUZXh0ID0gIm1hcmdpbi1ib3R0b206NnB4OyBjb2xvcjojYWFhOyI7DQogIG92ZXJhbGxMYWJlbC50ZXh0Q29udGVudCA9ICJPdmVyYWxsIHByb2dyZXNzIjsNCg0KICBjb25zdCBvdmVyYWxsQmFyT3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgb3ZlcmFsbEJhck91dGVyLnN0eWxlLmNzc1RleHQgPQ0KICAgICJ3aWR0aDoxMDAlOyBoZWlnaHQ6MTRweDsgYmFja2dyb3VuZDojMjIyOyBib3JkZXItcmFkaXVzOjk5OXB4OyBvdmVyZmxvdzpoaWRkZW47IGJvcmRlcjoxcHggc29saWQgIzMzMzsiOw0KICBjb25zdCBvdmVyYWxsQmFySW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgb3ZlcmFsbEJhcklubmVyLnN0eWxlLmNzc1RleHQgPQ0KICAgICJoZWlnaHQ6MTAwJTsgd2lkdGg6MCU7IGJhY2tncm91bmQ6IzI4YTc0NTsgdHJhbnNpdGlvbjogd2lkdGggMC4wOHMgbGluZWFyOyI7DQogIG92ZXJhbGxCYXJPdXRlci5hcHBlbmRDaGlsZChvdmVyYWxsQmFySW5uZXIpOw0KDQogIGNvbnN0IG92ZXJhbGxNZXRhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogIG92ZXJhbGxNZXRhLnN0eWxlLmNzc1RleHQgPSAibWFyZ2luLXRvcDo2cHg7IGNvbG9yOiM5OTk7IjsNCg0KICBjb25zdCBzcGVlZEV0YVJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICBzcGVlZEV0YVJvdy5zdHlsZS5jc3NUZXh0ID0NCiAgICAibWFyZ2luLXRvcDo4cHg7IGRpc3BsYXk6ZmxleDsgZ2FwOjE0cHg7IGZsZXgtd3JhcDp3cmFwOyBjb2xvcjojYmJiOyI7DQoNCiAgY29uc3Qgc3BlZWRFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICBjb25zdCBldGFFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICBzcGVlZEVsLnRleHRDb250ZW50ID0gIlNwZWVkOiDigJQiOw0KICBldGFFbC50ZXh0Q29udGVudCA9ICJFVEE6IOKAlCI7DQogIHNwZWVkRXRhUm93LmFwcGVuZENoaWxkKHNwZWVkRWwpOw0KICBzcGVlZEV0YVJvdy5hcHBlbmRDaGlsZChldGFFbCk7DQoNCiAgY29uc3QgY3VyTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgY3VyTGFiZWwuc3R5bGUuY3NzVGV4dCA9ICJtYXJnaW4tdG9wOjE0cHg7IG1hcmdpbi1ib3R0b206NnB4OyBjb2xvcjojYWFhOyI7DQogIGN1ckxhYmVsLnRleHRDb250ZW50ID0gIkN1cnJlbnQgZmlsZSI7DQoNCiAgY29uc3QgY3VyRmlsZU5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgY3VyRmlsZU5hbWUuc3R5bGUuY3NzVGV4dCA9DQogICAgImZvbnQtZmFtaWx5OiB1aS1tb25vc3BhY2UsIFNGTW9uby1SZWd1bGFyLCBNZW5sbywgTW9uYWNvLCBDb25zb2xhcywgJ0xpYmVyYXRpb24gTW9ubycsICdDb3VyaWVyIE5ldycsIG1vbm9zcGFjZTsgY29sb3I6I2RkZDsgd29yZC1icmVhazpicmVhay1hbGw7IjsNCg0KICBjb25zdCBjdXJCYXJPdXRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICBjdXJCYXJPdXRlci5zdHlsZS5jc3NUZXh0ID0NCiAgICAid2lkdGg6MTAwJTsgaGVpZ2h0OjEycHg7IGJhY2tncm91bmQ6IzIyMjsgYm9yZGVyLXJhZGl1czo5OTlweDsgb3ZlcmZsb3c6aGlkZGVuOyBib3JkZXI6MXB4IHNvbGlkICMzMzM7IG1hcmdpbi10b3A6OHB4OyI7DQogIGNvbnN0IGN1ckJhcklubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogIGN1ckJhcklubmVyLnN0eWxlLmNzc1RleHQgPQ0KICAgICJoZWlnaHQ6MTAwJTsgd2lkdGg6MCU7IGJhY2tncm91bmQ6IzA5YWRkMzsgdHJhbnNpdGlvbjogd2lkdGggMC4wOHMgbGluZWFyOyI7DQogIGN1ckJhck91dGVyLmFwcGVuZENoaWxkKGN1ckJhcklubmVyKTsNCg0KICBjb25zdCBjdXJNZXRhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogIGN1ck1ldGEuc3R5bGUuY3NzVGV4dCA9ICJtYXJnaW4tdG9wOjZweDsgY29sb3I6Izk5OTsiOw0KDQogIHByb2dXcmFwLmFwcGVuZENoaWxkKG92ZXJhbGxMYWJlbCk7DQogIHByb2dXcmFwLmFwcGVuZENoaWxkKG92ZXJhbGxCYXJPdXRlcik7DQogIHByb2dXcmFwLmFwcGVuZENoaWxkKG92ZXJhbGxNZXRhKTsNCiAgcHJvZ1dyYXAuYXBwZW5kQ2hpbGQoc3BlZWRFdGFSb3cpOw0KICBwcm9nV3JhcC5hcHBlbmRDaGlsZChjdXJMYWJlbCk7DQogIHByb2dXcmFwLmFwcGVuZENoaWxkKGN1ckZpbGVOYW1lKTsNCiAgcHJvZ1dyYXAuYXBwZW5kQ2hpbGQoY3VyQmFyT3V0ZXIpOw0KICBwcm9nV3JhcC5hcHBlbmRDaGlsZChjdXJNZXRhKTsNCg0KICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBsYXlCdG4pOw0KICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHN0YXR1cyk7DQogIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocHJvZ1dyYXApOw0KDQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogIC8vIEhlbHBlciBmdW5jdGlvbnMNCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgZnVuY3Rpb24gc2V0U3RhdHVzKHRleHQpIHsNCiAgICBzdGF0dXMudGV4dENvbnRlbnQgPSB0ZXh0Ow0KICB9DQoNCiAgZnVuY3Rpb24gcmVzb2x2ZVVSTCh1cmwsIGJhc2UpIHsNCiAgICB0cnkgew0KICAgICAgcmV0dXJuIG5ldyBVUkwodXJsLCBiYXNlKS5ocmVmOw0KICAgIH0gY2F0Y2ggew0KICAgICAgcmV0dXJuIHVybDsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBjYWNoZUJ1c3RlZFVSTCh1cmwpIHsNCiAgICBjb25zdCBzZXAgPSB1cmwuaW5jbHVkZXMoIj8iKSA/ICImIiA6ICI/IjsNCiAgICByZXR1cm4gdXJsICsgc2VwICsgImNiPSIgKyBEYXRlLm5vdygpICsgTWF0aC5yYW5kb20oKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZtdEJ5dGVzKG4pIHsNCiAgICBpZiAobiA9PSBudWxsIHx8IE51bWJlci5pc05hTihuKSkgcmV0dXJuICJ1bmtub3duIjsNCiAgICBjb25zdCB1bml0cyA9IFsiQiIsICJLQiIsICJNQiIsICJHQiJdOw0KICAgIGxldCBpID0gMDsNCiAgICBsZXQgdiA9IG47DQogICAgd2hpbGUgKHYgPj0gMTAyNCAmJiBpIDwgdW5pdHMubGVuZ3RoIC0gMSkgew0KICAgICAgdiAvPSAxMDI0Ow0KICAgICAgaSsrOw0KICAgIH0NCiAgICByZXR1cm4gYCR7di50b0ZpeGVkKGkgPT09IDAgPyAwIDogMil9ICR7dW5pdHNbaV19YDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZtdFNwZWVkKGJ5dGVzUGVyU2VjKSB7DQogICAgaWYgKCFpc0Zpbml0ZShieXRlc1BlclNlYykgfHwgYnl0ZXNQZXJTZWMgPD0gMCkgcmV0dXJuICLigJQiOw0KICAgIHJldHVybiBgJHtmbXRCeXRlcyhieXRlc1BlclNlYyl9L3NgOw0KICB9DQoNCiAgZnVuY3Rpb24gZm10VGltZShzZWNvbmRzKSB7DQogICAgaWYgKCFpc0Zpbml0ZShzZWNvbmRzKSB8fCBzZWNvbmRzIDwgMCkgcmV0dXJuICLigJQiOw0KICAgIGNvbnN0IHMgPSBNYXRoLnJvdW5kKHNlY29uZHMpOw0KICAgIGNvbnN0IGggPSBNYXRoLmZsb29yKHMgLyAzNjAwKTsNCiAgICBjb25zdCBtID0gTWF0aC5mbG9vcigocyAlIDM2MDApIC8gNjApOw0KICAgIGNvbnN0IHNlYyA9IHMgJSA2MDsNCiAgICBpZiAoaCA+IDApIHJldHVybiBgJHtofWggJHttfW0gJHtzZWN9c2A7DQogICAgaWYgKG0gPiAwKSByZXR1cm4gYCR7bX1tICR7c2VjfXNgOw0KICAgIHJldHVybiBgJHtzZWN9c2A7DQogIH0NCg0KICBmdW5jdGlvbiBiYXNlbmFtZUZyb21VUkwodSkgew0KICAgIHRyeSB7DQogICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHUpOw0KICAgICAgY29uc3QgcCA9IHVybC5wYXRobmFtZTsNCiAgICAgIHJldHVybiBwLnNwbGl0KCIvIikuZmlsdGVyKEJvb2xlYW4pLnBvcCgpIHx8ICIoaW5kZXgpIjsNCiAgICB9IGNhdGNoIHsNCiAgICAgIGNvbnN0IHBhcnRzID0gKHUgfHwgIiIpLnNwbGl0KCIvIik7DQogICAgICByZXR1cm4gcGFydHNbcGFydHMubGVuZ3RoIC0gMV0gfHwgdSB8fCAiKHVua25vd24pIjsNCiAgICB9DQogIH0NCg0KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAvLyBQcm9ncmVzcyBzdGF0ZSArIHNwZWVkIHNhbXBsaW5nDQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogIGNvbnN0IHByb2dyZXNzU3RhdGUgPSB7DQogICAgdG90YWxLbm93bkJ5dGVzOiAwLA0KICAgIHRvdGFsTG9hZGVkQnl0ZXM6IDAsDQogICAgZmlsZXNQbGFubmVkOiAwLA0KICAgIGZpbGVzRG9uZTogMCwNCiAgICBjdXJyZW50OiB7DQogICAgICB1cmw6ICIiLA0KICAgICAga25vd25TaXplOiBudWxsLA0KICAgICAgbG9hZGVkOiAwLA0KICAgICAgaW5kZXg6IDAsDQogICAgfSwNCg0KICAgIC8vIHNwZWVkIHNhbXBsZXIgKEVNQS1pc2ggKyByb2xsaW5nKQ0KICAgIF9zcGVlZDogew0KICAgICAgbGFzdFQ6IDAsDQogICAgICBsYXN0Qnl0ZXM6IDAsDQogICAgICBicHM6IDAsICAgICAgICAgIC8vIHNtb290aGVkIGJ5dGVzL3NlYw0KICAgICAgYWxwaGE6IDAuMTgsICAgICAvLyBzbW9vdGhpbmcgZmFjdG9yICgwLi4xKQ0KICAgICAgc3RhcnRlZEF0OiAwLA0KICAgIH0sDQogIH07DQoNCiAgZnVuY3Rpb24gc2hvd1Byb2dyZXNzVUkoc2hvdykgew0KICAgIHByb2dXcmFwLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gImJsb2NrIiA6ICJub25lIjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVwZGF0ZVNwZWVkQW5kRVRBKCkgew0KICAgIGNvbnN0IG5vdyA9IHBlcmZvcm1hbmNlLm5vdygpOw0KICAgIGNvbnN0IHNwID0gcHJvZ3Jlc3NTdGF0ZS5fc3BlZWQ7DQoNCiAgICBpZiAoIXNwLnN0YXJ0ZWRBdCkgc3Auc3RhcnRlZEF0ID0gbm93Ow0KICAgIGlmICghc3AubGFzdFQpIHsNCiAgICAgIHNwLmxhc3RUID0gbm93Ow0KICAgICAgc3AubGFzdEJ5dGVzID0gcHJvZ3Jlc3NTdGF0ZS50b3RhbExvYWRlZEJ5dGVzOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnN0IGR0ID0gKG5vdyAtIHNwLmxhc3RUKSAvIDEwMDA7DQogICAgaWYgKGR0IDw9IDAuMTUpIHJldHVybjsgLy8gZG9uJ3QgdXBkYXRlIHRvbyBvZnRlbg0KDQogICAgY29uc3QgZGIgPSBwcm9ncmVzc1N0YXRlLnRvdGFsTG9hZGVkQnl0ZXMgLSBzcC5sYXN0Qnl0ZXM7DQogICAgY29uc3QgaW5zdEJwcyA9IGRiID4gMCA/IGRiIC8gZHQgOiAwOw0KDQogICAgLy8gZXhwb25lbnRpYWwgbW92aW5nIGF2ZXJhZ2UNCiAgICBzcC5icHMgPSBzcC5icHMgPT09IDAgPyBpbnN0QnBzIDogKHNwLmFscGhhICogaW5zdEJwcyArICgxIC0gc3AuYWxwaGEpICogc3AuYnBzKTsNCg0KICAgIHNwLmxhc3RUID0gbm93Ow0KICAgIHNwLmxhc3RCeXRlcyA9IHByb2dyZXNzU3RhdGUudG90YWxMb2FkZWRCeXRlczsNCg0KICAgIHNwZWVkRWwudGV4dENvbnRlbnQgPSBgU3BlZWQ6ICR7Zm10U3BlZWQoc3AuYnBzKX1gOw0KDQogICAgLy8gRVRBIGxvZ2ljOg0KICAgIC8vIElmIHdlIGtub3cgdG90YWwgYnl0ZXMsIHVzZSB0aGF0Lg0KICAgIC8vIEVsc2UsIGVzdGltYXRlIHZpYSAoZmlsZXMgcmVtYWluaW5nKSAqIChhdmcgYnl0ZXMgcGVyIGZpbGUgc28gZmFyKSAvIHNwZWVkLg0KICAgIGxldCBldGFTZWNvbmRzID0gTmFOOw0KDQogICAgY29uc3Qga25vd25Ub3RhbCA9IHByb2dyZXNzU3RhdGUudG90YWxLbm93bkJ5dGVzOw0KICAgIGlmIChrbm93blRvdGFsID4gMCAmJiBzcC5icHMgPiAwKSB7DQogICAgICBjb25zdCByZW1haW5pbmcgPSBNYXRoLm1heCgwLCBrbm93blRvdGFsIC0gcHJvZ3Jlc3NTdGF0ZS50b3RhbExvYWRlZEJ5dGVzKTsNCiAgICAgIGV0YVNlY29uZHMgPSByZW1haW5pbmcgLyBzcC5icHM7DQogICAgICBldGFFbC50ZXh0Q29udGVudCA9IGBFVEE6ICR7Zm10VGltZShldGFTZWNvbmRzKX1gOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIGZhbGxiYWNrIEVUQSAoYmVzdC1lZmZvcnQpDQogICAgY29uc3QgcmVtYWluaW5nRmlsZXMgPSBNYXRoLm1heCgwLCBwcm9ncmVzc1N0YXRlLmZpbGVzUGxhbm5lZCAtIHByb2dyZXNzU3RhdGUuZmlsZXNEb25lKTsNCiAgICBpZiAoc3AuYnBzID4gMCAmJiBwcm9ncmVzc1N0YXRlLmZpbGVzRG9uZSA+IDApIHsNCiAgICAgIGNvbnN0IGF2Z0J5dGVzUGVyRmlsZSA9IHByb2dyZXNzU3RhdGUudG90YWxMb2FkZWRCeXRlcyAvIHByb2dyZXNzU3RhdGUuZmlsZXNEb25lOw0KICAgICAgY29uc3QgcmVtYWluaW5nQnl0ZXNFc3RpbWF0ZSA9IHJlbWFpbmluZ0ZpbGVzICogYXZnQnl0ZXNQZXJGaWxlOw0KICAgICAgZXRhU2Vjb25kcyA9IHJlbWFpbmluZ0J5dGVzRXN0aW1hdGUgLyBzcC5icHM7DQogICAgICBldGFFbC50ZXh0Q29udGVudCA9IGBFVEE6IH4ke2ZtdFRpbWUoZXRhU2Vjb25kcyl9IChlc3RpbWF0ZSlgOw0KICAgIH0gZWxzZSB7DQogICAgICBldGFFbC50ZXh0Q29udGVudCA9ICJFVEE6IOKAlCI7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gdXBkYXRlUHJvZ3Jlc3NVSSgpIHsNCiAgICBjb25zdCBrbm93blRvdGFsID0gcHJvZ3Jlc3NTdGF0ZS50b3RhbEtub3duQnl0ZXM7DQogICAgY29uc3QgbG9hZGVkVG90YWwgPSBwcm9ncmVzc1N0YXRlLnRvdGFsTG9hZGVkQnl0ZXM7DQoNCiAgICAvLyBvdmVyYWxsIGJhcg0KICAgIGlmIChrbm93blRvdGFsID4gMCkgew0KICAgICAgY29uc3Qgb3ZlcmFsbFBjdCA9IE1hdGgubWluKDEwMCwgKGxvYWRlZFRvdGFsIC8ga25vd25Ub3RhbCkgKiAxMDApOw0KICAgICAgb3ZlcmFsbEJhcklubmVyLnN0eWxlLndpZHRoID0gb3ZlcmFsbFBjdC50b0ZpeGVkKDIpICsgIiUiOw0KICAgICAgb3ZlcmFsbE1ldGEudGV4dENvbnRlbnQgPQ0KICAgICAgICBgJHtmbXRCeXRlcyhsb2FkZWRUb3RhbCl9IC8gJHtmbXRCeXRlcyhrbm93blRvdGFsKX0g4oCiIGAgKw0KICAgICAgICBgJHtwcm9ncmVzc1N0YXRlLmZpbGVzRG9uZX0vJHtwcm9ncmVzc1N0YXRlLmZpbGVzUGxhbm5lZH0gZmlsZXNgOw0KICAgIH0gZWxzZSB7DQogICAgICBjb25zdCBmcCA9DQogICAgICAgIHByb2dyZXNzU3RhdGUuZmlsZXNQbGFubmVkID4gMA0KICAgICAgICAgID8gKHByb2dyZXNzU3RhdGUuZmlsZXNEb25lIC8gcHJvZ3Jlc3NTdGF0ZS5maWxlc1BsYW5uZWQpICogMTAwDQogICAgICAgICAgOiAwOw0KICAgICAgb3ZlcmFsbEJhcklubmVyLnN0eWxlLndpZHRoID0gZnAudG9GaXhlZCgyKSArICIlIjsNCiAgICAgIG92ZXJhbGxNZXRhLnRleHRDb250ZW50ID0NCiAgICAgICAgYCR7Zm10Qnl0ZXMobG9hZGVkVG90YWwpfSBkb3dubG9hZGVkIOKAoiBgICsNCiAgICAgICAgYCR7cHJvZ3Jlc3NTdGF0ZS5maWxlc0RvbmV9LyR7cHJvZ3Jlc3NTdGF0ZS5maWxlc1BsYW5uZWR9IGZpbGVzYDsNCiAgICB9DQoNCiAgICAvLyBjdXJyZW50IGZpbGUgYmFyDQogICAgY29uc3QgYyA9IHByb2dyZXNzU3RhdGUuY3VycmVudDsNCiAgICBpZiAoYy51cmwpIHsNCiAgICAgIGNvbnN0IHNob3J0ID0gYmFzZW5hbWVGcm9tVVJMKGMudXJsKTsNCiAgICAgIGN1ckZpbGVOYW1lLnRleHRDb250ZW50ID0gYCgke2MuaW5kZXh9LyR7cHJvZ3Jlc3NTdGF0ZS5maWxlc1BsYW5uZWR9KSAke3Nob3J0fWA7DQoNCiAgICAgIGlmIChjLmtub3duU2l6ZSAhPSBudWxsICYmIGMua25vd25TaXplID4gMCkgew0KICAgICAgICBjb25zdCBwY3QgPSBNYXRoLm1pbigxMDAsIChjLmxvYWRlZCAvIGMua25vd25TaXplKSAqIDEwMCk7DQogICAgICAgIGN1ckJhcklubmVyLnN0eWxlLndpZHRoID0gcGN0LnRvRml4ZWQoMikgKyAiJSI7DQogICAgICAgIGN1ck1ldGEudGV4dENvbnRlbnQgPSBgJHtmbXRCeXRlcyhjLmxvYWRlZCl9IC8gJHtmbXRCeXRlcyhjLmtub3duU2l6ZSl9IOKAoiAke3BjdC50b0ZpeGVkKDEpfSVgOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8gdW5rbm93biBzaXplOiBwc2V1ZG8gYmFyLCBjbGFtcCB0byA5NSUgdW50aWwgZG9uZQ0KICAgICAgICBjb25zdCBwc2V1ZG8gPSBNYXRoLm1pbig5NSwgKGMubG9hZGVkIC8gKDEwMjQgKiA1MTIpKSAqIDEwMCk7DQogICAgICAgIGN1ckJhcklubmVyLnN0eWxlLndpZHRoID0gcHNldWRvLnRvRml4ZWQoMikgKyAiJSI7DQogICAgICAgIGN1ck1ldGEudGV4dENvbnRlbnQgPSBgJHtmbXRCeXRlcyhjLmxvYWRlZCl9IC8gdW5rbm93bmA7DQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIGN1ckZpbGVOYW1lLnRleHRDb250ZW50ID0gIiI7DQogICAgICBjdXJCYXJJbm5lci5zdHlsZS53aWR0aCA9ICIwJSI7DQogICAgICBjdXJNZXRhLnRleHRDb250ZW50ID0gIiI7DQogICAgfQ0KDQogICAgdXBkYXRlU3BlZWRBbmRFVEEoKTsNCiAgfQ0KDQogIC8vIFVwZGF0ZSBzcGVlZC9FVEEgZXZlbiBpZiBubyBuZXcgYnl0ZXMgKGtlZXBzIFVJIGFsaXZlKQ0KICBzZXRJbnRlcnZhbCgoKSA9PiB7DQogICAgaWYgKHByb2dXcmFwLnN0eWxlLmRpc3BsYXkgIT09ICJub25lIikgdXBkYXRlU3BlZWRBbmRFVEEoKTsNCiAgfSwgMjUwKTsNCg0KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAvLyBGZXRjaCB3aXRoIGJ5dGUgcHJvZ3Jlc3MNCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hXaXRoUHJvZ3Jlc3ModXJsLCBmcmVzaCA9IGZhbHNlLCBvbk1ldGEgPSBudWxsLCBvbkNodW5rID0gbnVsbCkgew0KICAgIGNvbnN0IGZldGNoVVJMID0gZnJlc2ggPyBjYWNoZUJ1c3RlZFVSTCh1cmwpIDogdXJsOw0KDQogICAgbGV0IHJlc3A7DQogICAgdHJ5IHsNCiAgICAgIHJlc3AgPSBhd2FpdCBmZXRjaChmZXRjaFVSTCwgeyBjYWNoZTogZnJlc2ggPyAibm8tc3RvcmUiIDogImRlZmF1bHQiIH0pOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGNvbnNvbGUud2FybigiRmFpbGVkIHRvIGZldGNoOiIsIHVybCwgZSk7DQogICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQoNCiAgICBpZiAoIXJlc3Aub2spIHsNCiAgICAgIGNvbnNvbGUud2FybigiTm9uLU9LIHJlc3BvbnNlOiIsIHJlc3Auc3RhdHVzLCB1cmwpOw0KICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KDQogICAgY29uc3QgbGVuSGVhZGVyID0gcmVzcC5oZWFkZXJzLmdldCgiY29udGVudC1sZW5ndGgiKTsNCiAgICBjb25zdCBrbm93blNpemUgPSBsZW5IZWFkZXIgPyBOdW1iZXIobGVuSGVhZGVyKSA6IG51bGw7DQoNCiAgICBpZiAob25NZXRhKSBvbk1ldGEoeyBrbm93blNpemUsIGNvbnRlbnRUeXBlOiByZXNwLmhlYWRlcnMuZ2V0KCJjb250ZW50LXR5cGUiKSB9KTsNCg0KICAgIGlmICghcmVzcC5ib2R5IHx8ICFyZXNwLmJvZHkuZ2V0UmVhZGVyKSB7DQogICAgICBjb25zdCBibG9iID0gYXdhaXQgcmVzcC5ibG9iKCk7DQogICAgICByZXR1cm4geyBibG9iLCBrbm93blNpemU6IGJsb2Iuc2l6ZSA/PyBrbm93blNpemUgfTsNCiAgICB9DQoNCiAgICBjb25zdCByZWFkZXIgPSByZXNwLmJvZHkuZ2V0UmVhZGVyKCk7DQogICAgY29uc3QgY2h1bmtzID0gW107DQogICAgbGV0IGxvYWRlZCA9IDA7DQoNCiAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgY29uc3QgeyBkb25lLCB2YWx1ZSB9ID0gYXdhaXQgcmVhZGVyLnJlYWQoKTsNCiAgICAgIGlmIChkb25lKSBicmVhazsNCiAgICAgIGNodW5rcy5wdXNoKHZhbHVlKTsNCiAgICAgIGxvYWRlZCArPSB2YWx1ZS5ieXRlTGVuZ3RoOw0KICAgICAgaWYgKG9uQ2h1bmspIG9uQ2h1bmsobG9hZGVkKTsNCiAgICB9DQoNCiAgICBjb25zdCBjb250ZW50VHlwZSA9IHJlc3AuaGVhZGVycy5nZXQoImNvbnRlbnQtdHlwZSIpIHx8ICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iOw0KICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihjaHVua3MsIHsgdHlwZTogY29udGVudFR5cGUgfSk7DQogICAgcmV0dXJuIHsgYmxvYiwga25vd25TaXplOiBrbm93blNpemUgPz8gYmxvYi5zaXplIH07DQogIH0NCg0KICBhc3luYyBmdW5jdGlvbiBibG9iVG9EYXRhVVJMKGJsb2IpIHsNCiAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlcykgPT4gew0KICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCiAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSAoKSA9PiByZXMocmVhZGVyLnJlc3VsdCk7DQogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iKTsNCiAgICB9KTsNCiAgfQ0KDQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogIC8vIEFzc2V0IHBsYW5uaW5nICsgaW5saW5pbmcNCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgZnVuY3Rpb24gcGxhbkFzc2V0cyhkb2MsIGJhc2UpIHsNCiAgICBjb25zdCB1cmxzID0gbmV3IFNldCgpOw0KDQogICAgZm9yIChjb25zdCBsaW5rIG9mIEFycmF5LmZyb20oZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpbmtbcmVsPSJzdHlsZXNoZWV0Il0nKSkpIHsNCiAgICAgIGNvbnN0IGhyZWZSYXcgPSBsaW5rLmhyZWYgfHwgbGluay5nZXRBdHRyaWJ1dGUoImhyZWYiKTsNCiAgICAgIGlmICghaHJlZlJhdykgY29udGludWU7DQogICAgICB1cmxzLmFkZChyZXNvbHZlVVJMKGhyZWZSYXcsIGJhc2UpKTsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHNjcmlwdCBvZiBBcnJheS5mcm9tKGRvYy5xdWVyeVNlbGVjdG9yQWxsKCJzY3JpcHRbc3JjXSIpKSkgew0KICAgICAgY29uc3Qgc3JjUmF3ID0gc2NyaXB0LnNyYyB8fCBzY3JpcHQuZ2V0QXR0cmlidXRlKCJzcmMiKTsNCiAgICAgIGlmICghc3JjUmF3KSBjb250aW51ZTsNCiAgICAgIHVybHMuYWRkKHJlc29sdmVVUkwoc3JjUmF3LCBiYXNlKSk7DQogICAgfQ0KDQogICAgZm9yIChjb25zdCBpbWcgb2YgQXJyYXkuZnJvbShkb2MucXVlcnlTZWxlY3RvckFsbCgiaW1nW3NyY10iKSkpIHsNCiAgICAgIGNvbnN0IHNyYyA9IGltZy5nZXRBdHRyaWJ1dGUoInNyYyIpOw0KICAgICAgaWYgKHNyYyAmJiAhc3JjLnN0YXJ0c1dpdGgoImRhdGE6IikpIHVybHMuYWRkKHJlc29sdmVVUkwoc3JjLCBiYXNlKSk7DQogICAgfQ0KDQogICAgZm9yIChjb25zdCBtZWRpYSBvZiBBcnJheS5mcm9tKGRvYy5xdWVyeVNlbGVjdG9yQWxsKCJ2aWRlbywgYXVkaW8iKSkpIHsNCiAgICAgIGNvbnN0IHNvdXJjZXMgPSBBcnJheS5mcm9tKG1lZGlhLnF1ZXJ5U2VsZWN0b3JBbGwoInNvdXJjZSIpKTsNCiAgICAgIGZvciAoY29uc3QgcyBvZiBzb3VyY2VzKSB7DQogICAgICAgIGNvbnN0IHNyYyA9IHMuZ2V0QXR0cmlidXRlKCJzcmMiKTsNCiAgICAgICAgaWYgKHNyYyAmJiAhc3JjLnN0YXJ0c1dpdGgoImRhdGE6IikpIHVybHMuYWRkKHJlc29sdmVVUkwoc3JjLCBiYXNlKSk7DQogICAgICB9DQogICAgICBpZiAobWVkaWEudGFnTmFtZSA9PT0gIlZJREVPIiAmJiBtZWRpYS5wb3N0ZXIpIHsNCiAgICAgICAgdXJscy5hZGQocmVzb2x2ZVVSTChtZWRpYS5wb3N0ZXIsIGJhc2UpKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gQXJyYXkuZnJvbSh1cmxzKTsNCiAgfQ0KDQogIGFzeW5jIGZ1bmN0aW9uIGlubGluZUNTUyhjc3NUZXh0LCBiYXNlLCBmcmVzaCA9IGZhbHNlLCBjYWNoZSA9IG5ldyBNYXAoKSkgew0KICAgIGNvbnN0IHVybFJlZ2V4ID0gL3VybFwoXHMqKFsnIl0/KSguKj8pXDFccypcKS9nOw0KICAgIGNvbnN0IG1hdGNoZXMgPSBbLi4uY3NzVGV4dC5tYXRjaEFsbCh1cmxSZWdleCldOw0KDQogICAgZm9yIChjb25zdCBtIG9mIG1hdGNoZXMpIHsNCiAgICAgIGNvbnN0IHJhdyA9IG1bMl07DQogICAgICBpZiAoIXJhdyB8fCByYXcuc3RhcnRzV2l0aCgiZGF0YToiKSkgY29udGludWU7DQoNCiAgICAgIGNvbnN0IGFicyA9IHJlc29sdmVVUkwocmF3LCBiYXNlKTsNCg0KICAgICAgbGV0IGRhdGFVcmwgPSBjYWNoZS5nZXQoYWJzKTsNCiAgICAgIGlmICghZGF0YVVybCkgew0KICAgICAgICBkYXRhVXJsID0gYXdhaXQgZG93bmxvYWRCaW5hcnlBc0RhdGFVUkwoYWJzLCBmcmVzaCk7DQogICAgICAgIGlmIChkYXRhVXJsKSBjYWNoZS5zZXQoYWJzLCBkYXRhVXJsKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKGRhdGFVcmwpIHsNCiAgICAgICAgY3NzVGV4dCA9IGNzc1RleHQucmVwbGFjZSgNCiAgICAgICAgICBuZXcgUmVnRXhwKHJhdy5yZXBsYWNlKC9bLS9cXF4kKis/LigpfFtcXXt9XS9nLCAiXFwkJiIpLCAiZyIpLA0KICAgICAgICAgIGRhdGFVcmwNCiAgICAgICAgKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gYDxzdHlsZT4ke2Nzc1RleHR9PC9zdHlsZT5gOw0KICB9DQoNCiAgZnVuY3Rpb24gYnVtcEN1cnJlbnRJbmRleCgpIHsNCiAgICAvLyB3ZSBjb3VudCAibWFpbiBIVE1MIiBhcyBmaWxlIDEgYWxyZWFkeQ0KICAgIHByb2dyZXNzU3RhdGUuY3VycmVudC5pbmRleCA9IE1hdGgubWluKHByb2dyZXNzU3RhdGUuZmlsZXNQbGFubmVkLCBwcm9ncmVzc1N0YXRlLmZpbGVzRG9uZSArIDEpOw0KICB9DQoNCiAgYXN5bmMgZnVuY3Rpb24gZG93bmxvYWRCaW5hcnlBc0RhdGFVUkwodXJsLCBmcmVzaCA9IGZhbHNlKSB7DQogICAgYnVtcEN1cnJlbnRJbmRleCgpOw0KICAgIHByb2dyZXNzU3RhdGUuY3VycmVudC51cmwgPSB1cmw7DQogICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50LmxvYWRlZCA9IDA7DQogICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50Lmtub3duU2l6ZSA9IG51bGw7DQogICAgdXBkYXRlUHJvZ3Jlc3NVSSgpOw0KDQogICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZmV0Y2hXaXRoUHJvZ3Jlc3MoDQogICAgICB1cmwsDQogICAgICBmcmVzaCwNCiAgICAgICh7IGtub3duU2l6ZSB9KSA9PiB7DQogICAgICAgIHByb2dyZXNzU3RhdGUuY3VycmVudC5rbm93blNpemUgPSBrbm93blNpemU7DQogICAgICAgIGlmIChrbm93blNpemUgIT0gbnVsbCkgcHJvZ3Jlc3NTdGF0ZS50b3RhbEtub3duQnl0ZXMgKz0ga25vd25TaXplOw0KICAgICAgICB1cGRhdGVQcm9ncmVzc1VJKCk7DQogICAgICB9LA0KICAgICAgKGxvYWRlZCkgPT4gew0KICAgICAgICBjb25zdCBkZWx0YSA9IGxvYWRlZCAtIHByb2dyZXNzU3RhdGUuY3VycmVudC5sb2FkZWQ7DQogICAgICAgIHByb2dyZXNzU3RhdGUuY3VycmVudC5sb2FkZWQgPSBsb2FkZWQ7DQogICAgICAgIHByb2dyZXNzU3RhdGUudG90YWxMb2FkZWRCeXRlcyArPSBNYXRoLm1heCgwLCBkZWx0YSk7DQogICAgICAgIHVwZGF0ZVByb2dyZXNzVUkoKTsNCiAgICAgIH0NCiAgICApOw0KDQogICAgaWYgKCFyZXN1bHQgfHwgIXJlc3VsdC5ibG9iKSB7DQogICAgICBwcm9ncmVzc1N0YXRlLmZpbGVzRG9uZSsrOw0KICAgICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50LnVybCA9ICIiOw0KICAgICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50Lmtub3duU2l6ZSA9IG51bGw7DQogICAgICBwcm9ncmVzc1N0YXRlLmN1cnJlbnQubG9hZGVkID0gMDsNCiAgICAgIHVwZGF0ZVByb2dyZXNzVUkoKTsNCiAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCg0KICAgIC8vIGZpbmlzaCBjdXJyZW50IGZpbGUNCiAgICBwcm9ncmVzc1N0YXRlLmN1cnJlbnQubG9hZGVkID0gcmVzdWx0LmJsb2Iuc2l6ZTsNCiAgICBjdXJCYXJJbm5lci5zdHlsZS53aWR0aCA9ICIxMDAlIjsNCiAgICBjdXJNZXRhLnRleHRDb250ZW50ID0gYCR7Zm10Qnl0ZXMocmVzdWx0LmJsb2Iuc2l6ZSl9IC8gJHtmbXRCeXRlcyhyZXN1bHQua25vd25TaXplKX0g4oCiIDEwMCVgOw0KDQogICAgY29uc3QgZGF0YVVybCA9IGF3YWl0IGJsb2JUb0RhdGFVUkwocmVzdWx0LmJsb2IpOw0KDQogICAgcHJvZ3Jlc3NTdGF0ZS5maWxlc0RvbmUrKzsNCiAgICBwcm9ncmVzc1N0YXRlLmN1cnJlbnQudXJsID0gIiI7DQogICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50Lmtub3duU2l6ZSA9IG51bGw7DQogICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50LmxvYWRlZCA9IDA7DQogICAgdXBkYXRlUHJvZ3Jlc3NVSSgpOw0KDQogICAgcmV0dXJuIGRhdGFVcmw7DQogIH0NCg0KICBhc3luYyBmdW5jdGlvbiBkb3dubG9hZFRleHQodXJsLCBmcmVzaCA9IGZhbHNlKSB7DQogICAgYnVtcEN1cnJlbnRJbmRleCgpOw0KICAgIHByb2dyZXNzU3RhdGUuY3VycmVudC51cmwgPSB1cmw7DQogICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50LmxvYWRlZCA9IDA7DQogICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50Lmtub3duU2l6ZSA9IG51bGw7DQogICAgdXBkYXRlUHJvZ3Jlc3NVSSgpOw0KDQogICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZmV0Y2hXaXRoUHJvZ3Jlc3MoDQogICAgICB1cmwsDQogICAgICBmcmVzaCwNCiAgICAgICh7IGtub3duU2l6ZSB9KSA9PiB7DQogICAgICAgIHByb2dyZXNzU3RhdGUuY3VycmVudC5rbm93blNpemUgPSBrbm93blNpemU7DQogICAgICAgIGlmIChrbm93blNpemUgIT0gbnVsbCkgcHJvZ3Jlc3NTdGF0ZS50b3RhbEtub3duQnl0ZXMgKz0ga25vd25TaXplOw0KICAgICAgICB1cGRhdGVQcm9ncmVzc1VJKCk7DQogICAgICB9LA0KICAgICAgKGxvYWRlZCkgPT4gew0KICAgICAgICBjb25zdCBkZWx0YSA9IGxvYWRlZCAtIHByb2dyZXNzU3RhdGUuY3VycmVudC5sb2FkZWQ7DQogICAgICAgIHByb2dyZXNzU3RhdGUuY3VycmVudC5sb2FkZWQgPSBsb2FkZWQ7DQogICAgICAgIHByb2dyZXNzU3RhdGUudG90YWxMb2FkZWRCeXRlcyArPSBNYXRoLm1heCgwLCBkZWx0YSk7DQogICAgICAgIHVwZGF0ZVByb2dyZXNzVUkoKTsNCiAgICAgIH0NCiAgICApOw0KDQogICAgaWYgKCFyZXN1bHQgfHwgIXJlc3VsdC5ibG9iKSB7DQogICAgICBwcm9ncmVzc1N0YXRlLmZpbGVzRG9uZSsrOw0KICAgICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50LnVybCA9ICIiOw0KICAgICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50Lmtub3duU2l6ZSA9IG51bGw7DQogICAgICBwcm9ncmVzc1N0YXRlLmN1cnJlbnQubG9hZGVkID0gMDsNCiAgICAgIHVwZGF0ZVByb2dyZXNzVUkoKTsNCiAgICAgIHJldHVybiAiIjsNCiAgICB9DQoNCiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzdWx0LmJsb2IudGV4dCgpOw0KDQogICAgcHJvZ3Jlc3NTdGF0ZS5maWxlc0RvbmUrKzsNCiAgICBwcm9ncmVzc1N0YXRlLmN1cnJlbnQudXJsID0gIiI7DQogICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50Lmtub3duU2l6ZSA9IG51bGw7DQogICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50LmxvYWRlZCA9IDA7DQogICAgdXBkYXRlUHJvZ3Jlc3NVSSgpOw0KDQogICAgcmV0dXJuIHRleHQ7DQogIH0NCg0KICBhc3luYyBmdW5jdGlvbiBpbmxpbmVBc3NldHMoZG9jLCBiYXNlLCBmcmVzaCA9IGZhbHNlKSB7DQogICAgY29uc3QgY2FjaGUgPSBuZXcgTWFwKCk7IC8vIHVybCAtPiBkYXRhVVJMIChwcmV2ZW50cyByZWRvd25sb2FkaW5nKQ0KICAgIGNvbnN0IHByb21pc2VzID0gW107DQoNCiAgICBmb3IgKGNvbnN0IGxpbmsgb2YgQXJyYXkuZnJvbShkb2MucXVlcnlTZWxlY3RvckFsbCgnbGlua1tyZWw9InN0eWxlc2hlZXQiXScpKSkgew0KICAgICAgcHJvbWlzZXMucHVzaCgNCiAgICAgICAgKGFzeW5jICgpID0+IHsNCiAgICAgICAgICBjb25zdCBocmVmID0gcmVzb2x2ZVVSTChsaW5rLmhyZWYgfHwgbGluay5nZXRBdHRyaWJ1dGUoImhyZWYiKSwgYmFzZSk7DQogICAgICAgICAgY29uc3QgY3NzID0gYXdhaXQgZG93bmxvYWRUZXh0KGhyZWYsIGZyZXNoKTsNCiAgICAgICAgICBpZiAoY3NzKSBsaW5rLm91dGVySFRNTCA9IGF3YWl0IGlubGluZUNTUyhjc3MsIGhyZWYsIGZyZXNoLCBjYWNoZSk7DQogICAgICAgIH0pKCkNCiAgICAgICk7DQogICAgfQ0KDQogICAgZm9yIChjb25zdCBzY3JpcHQgb2YgQXJyYXkuZnJvbShkb2MucXVlcnlTZWxlY3RvckFsbCgic2NyaXB0W3NyY10iKSkpIHsNCiAgICAgIHByb21pc2VzLnB1c2goDQogICAgICAgIChhc3luYyAoKSA9PiB7DQogICAgICAgICAgY29uc3Qgc3JjID0gcmVzb2x2ZVVSTChzY3JpcHQuc3JjIHx8IHNjcmlwdC5nZXRBdHRyaWJ1dGUoInNyYyIpLCBiYXNlKTsNCiAgICAgICAgICBjb25zdCBqcyA9IGF3YWl0IGRvd25sb2FkVGV4dChzcmMsIGZyZXNoKTsNCiAgICAgICAgICBpZiAoanMpIHNjcmlwdC5vdXRlckhUTUwgPSBgPHNjcmlwdD4ke2pzfTxcL3NjcmlwdD5gOw0KICAgICAgICB9KSgpDQogICAgICApOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgaW1nIG9mIEFycmF5LmZyb20oZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoImltZ1tzcmNdIikpKSB7DQogICAgICBwcm9taXNlcy5wdXNoKA0KICAgICAgICAoYXN5bmMgKCkgPT4gew0KICAgICAgICAgIGNvbnN0IHNyYyA9IGltZy5nZXRBdHRyaWJ1dGUoInNyYyIpOw0KICAgICAgICAgIGlmIChzcmMgJiYgIXNyYy5zdGFydHNXaXRoKCJkYXRhOiIpKSB7DQogICAgICAgICAgICBjb25zdCBhYnMgPSByZXNvbHZlVVJMKHNyYywgYmFzZSk7DQogICAgICAgICAgICBsZXQgZGF0YVVybCA9IGNhY2hlLmdldChhYnMpOw0KICAgICAgICAgICAgaWYgKCFkYXRhVXJsKSB7DQogICAgICAgICAgICAgIGRhdGFVcmwgPSBhd2FpdCBkb3dubG9hZEJpbmFyeUFzRGF0YVVSTChhYnMsIGZyZXNoKTsNCiAgICAgICAgICAgICAgaWYgKGRhdGFVcmwpIGNhY2hlLnNldChhYnMsIGRhdGFVcmwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRhdGFVcmwpIGltZy5zcmMgPSBkYXRhVXJsOw0KICAgICAgICAgIH0NCiAgICAgICAgfSkoKQ0KICAgICAgKTsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IG1lZGlhIG9mIEFycmF5LmZyb20oZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoInZpZGVvLCBhdWRpbyIpKSkgew0KICAgICAgY29uc3Qgc291cmNlcyA9IEFycmF5LmZyb20obWVkaWEucXVlcnlTZWxlY3RvckFsbCgic291cmNlIikpOw0KICAgICAgZm9yIChjb25zdCBzIG9mIHNvdXJjZXMpIHsNCiAgICAgICAgcHJvbWlzZXMucHVzaCgNCiAgICAgICAgICAoYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgY29uc3Qgc3JjID0gcy5nZXRBdHRyaWJ1dGUoInNyYyIpOw0KICAgICAgICAgICAgaWYgKHNyYyAmJiAhc3JjLnN0YXJ0c1dpdGgoImRhdGE6IikpIHsNCiAgICAgICAgICAgICAgY29uc3QgYWJzID0gcmVzb2x2ZVVSTChzcmMsIGJhc2UpOw0KICAgICAgICAgICAgICBsZXQgZGF0YVVybCA9IGNhY2hlLmdldChhYnMpOw0KICAgICAgICAgICAgICBpZiAoIWRhdGFVcmwpIHsNCiAgICAgICAgICAgICAgICBkYXRhVXJsID0gYXdhaXQgZG93bmxvYWRCaW5hcnlBc0RhdGFVUkwoYWJzLCBmcmVzaCk7DQogICAgICAgICAgICAgICAgaWYgKGRhdGFVcmwpIGNhY2hlLnNldChhYnMsIGRhdGFVcmwpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChkYXRhVXJsKSBzLnNyYyA9IGRhdGFVcmw7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSkoKQ0KICAgICAgICApOw0KICAgICAgfQ0KDQogICAgICBpZiAobWVkaWEudGFnTmFtZSA9PT0gIlZJREVPIiAmJiBtZWRpYS5wb3N0ZXIpIHsNCiAgICAgICAgcHJvbWlzZXMucHVzaCgNCiAgICAgICAgICAoYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgYWJzID0gcmVzb2x2ZVVSTChtZWRpYS5wb3N0ZXIsIGJhc2UpOw0KICAgICAgICAgICAgbGV0IGRhdGFVcmwgPSBjYWNoZS5nZXQoYWJzKTsNCiAgICAgICAgICAgIGlmICghZGF0YVVybCkgew0KICAgICAgICAgICAgICBkYXRhVXJsID0gYXdhaXQgZG93bmxvYWRCaW5hcnlBc0RhdGFVUkwoYWJzLCBmcmVzaCk7DQogICAgICAgICAgICAgIGlmIChkYXRhVXJsKSBjYWNoZS5zZXQoYWJzLCBkYXRhVXJsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkYXRhVXJsKSBtZWRpYS5wb3N0ZXIgPSBkYXRhVXJsOw0KICAgICAgICAgIH0pKCkNCiAgICAgICAgKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7DQogIH0NCg0KICBhc3luYyBmdW5jdGlvbiBjcmVhdGVCbG9iUGFnZShzaXRlVVJMLCBmcmVzaCA9IGZhbHNlKSB7DQogICAgcGxheUJ0bi5kaXNhYmxlZCA9IHRydWU7DQogICAgcGxheUJ0bi5zdHlsZS5vcGFjaXR5ID0gIjAuNyI7DQogICAgcGxheUJ0bi5zdHlsZS5jdXJzb3IgPSAibm90LWFsbG93ZWQiOw0KDQogICAgc2hvd1Byb2dyZXNzVUkodHJ1ZSk7DQoNCiAgICAvLyByZXNldCBzdGF0cw0KICAgIHByb2dyZXNzU3RhdGUudG90YWxLbm93bkJ5dGVzID0gMDsNCiAgICBwcm9ncmVzc1N0YXRlLnRvdGFsTG9hZGVkQnl0ZXMgPSAwOw0KICAgIHByb2dyZXNzU3RhdGUuZmlsZXNEb25lID0gMDsNCiAgICBwcm9ncmVzc1N0YXRlLmZpbGVzUGxhbm5lZCA9IDA7DQogICAgcHJvZ3Jlc3NTdGF0ZS5jdXJyZW50LnVybCA9ICIiOw0KICAgIHByb2dyZXNzU3RhdGUuY3VycmVudC5sb2FkZWQgPSAwOw0KICAgIHByb2dyZXNzU3RhdGUuY3VycmVudC5rbm93blNpemUgPSBudWxsOw0KICAgIHByb2dyZXNzU3RhdGUuX3NwZWVkLmxhc3RUID0gMDsNCiAgICBwcm9ncmVzc1N0YXRlLl9zcGVlZC5sYXN0Qnl0ZXMgPSAwOw0KICAgIHByb2dyZXNzU3RhdGUuX3NwZWVkLmJwcyA9IDA7DQogICAgcHJvZ3Jlc3NTdGF0ZS5fc3BlZWQuc3RhcnRlZEF0ID0gcGVyZm9ybWFuY2Uubm93KCk7DQoNCiAgICBzZXRTdGF0dXMoZnJlc2ggPyAiUmVkb3dubG9hZGluZyBzaXRlLi4uIiA6ICJGZXRjaGluZyBzaXRlLi4uIik7DQoNCiAgICAvLyBGZXRjaCBtYWluIEhUTUwgKGNvdW50cyBhcyBmaXJzdCBmaWxlKQ0KICAgIHByb2dyZXNzU3RhdGUuZmlsZXNQbGFubmVkID0gMTsNCiAgICBwcm9ncmVzc1N0YXRlLmN1cnJlbnQuaW5kZXggPSAxOw0KICAgIHVwZGF0ZVByb2dyZXNzVUkoKTsNCg0KICAgIGNvbnN0IGh0bWxUZXh0ID0gYXdhaXQgZG93bmxvYWRUZXh0KHNpdGVVUkwsIGZyZXNoKTsNCiAgICBpZiAoIWh0bWxUZXh0KSB7DQogICAgICBzZXRTdGF0dXMoIkZhaWxlZCB0byBmZXRjaCBzaXRlLiIpOw0KICAgICAgcGxheUJ0bi5kaXNhYmxlZCA9IGZhbHNlOw0KICAgICAgcGxheUJ0bi5zdHlsZS5vcGFjaXR5ID0gIjEiOw0KICAgICAgcGxheUJ0bi5zdHlsZS5jdXJzb3IgPSAicG9pbnRlciI7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgY29uc3QgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpOw0KICAgIGNvbnN0IGRvYyA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcoaHRtbFRleHQsICJ0ZXh0L2h0bWwiKTsNCiAgICBjb25zdCBiYXNlID0gc2l0ZVVSTDsNCg0KICAgIC8vIFBsYW4gYXNzZXRzIGZvciBmaWxlIGNvdW50DQogICAgY29uc3QgcGxhbm5lZCA9IHBsYW5Bc3NldHMoZG9jLCBiYXNlKTsNCiAgICBwcm9ncmVzc1N0YXRlLmZpbGVzUGxhbm5lZCA9IDEgKyBwbGFubmVkLmxlbmd0aDsgLy8gKyBtYWluIEhUTUwNCiAgICB1cGRhdGVQcm9ncmVzc1VJKCk7DQoNCiAgICBzZXRTdGF0dXMoIklubGluaW5nIGFzc2V0cy4uLiIpOw0KICAgIGF3YWl0IGlubGluZUFzc2V0cyhkb2MsIGJhc2UsIGZyZXNoKTsNCg0KICAgIGNvbnN0IGNzcE1ldGEgPSBkb2MucXVlcnlTZWxlY3RvcignbWV0YVtodHRwLWVxdWl2PSJDb250ZW50LVNlY3VyaXR5LVBvbGljeSJdJyk7DQogICAgaWYgKGNzcE1ldGEpIGNzcE1ldGEucmVtb3ZlKCk7DQoNCiAgICBzZXRTdGF0dXMoIkNyZWF0aW5nIGJsb2IuLi4iKTsNCiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoWyI8IWRvY3R5cGUgaHRtbD5cbiIgKyBkb2MuZG9jdW1lbnRFbGVtZW50Lm91dGVySFRNTF0sIHsNCiAgICAgIHR5cGU6ICJ0ZXh0L2h0bWwiLA0KICAgIH0pOw0KICAgIGNvbnN0IGJsb2JVUkwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOw0KDQogICAgd2luZG93Lm9wZW4oYmxvYlVSTCwgIl9ibGFuayIpOw0KDQogICAgLy8gRG9uZSBVSQ0KICAgIG92ZXJhbGxCYXJJbm5lci5zdHlsZS53aWR0aCA9ICIxMDAlIjsNCiAgICBjb25zdCB0b3RhbFN0ciA9DQogICAgICBwcm9ncmVzc1N0YXRlLnRvdGFsS25vd25CeXRlcyA+IDANCiAgICAgICAgPyBgJHtmbXRCeXRlcyhwcm9ncmVzc1N0YXRlLnRvdGFsTG9hZGVkQnl0ZXMpfSAvICR7Zm10Qnl0ZXMocHJvZ3Jlc3NTdGF0ZS50b3RhbEtub3duQnl0ZXMpfWANCiAgICAgICAgOiBgJHtmbXRCeXRlcyhwcm9ncmVzc1N0YXRlLnRvdGFsTG9hZGVkQnl0ZXMpfSBkb3dubG9hZGVkYDsNCg0KICAgIG92ZXJhbGxNZXRhLnRleHRDb250ZW50ID0gYENvbXBsZXRlZCDigKIgJHtwcm9ncmVzc1N0YXRlLmZpbGVzRG9uZX0vJHtwcm9ncmVzc1N0YXRlLmZpbGVzUGxhbm5lZH0gZmlsZXMg4oCiICR7dG90YWxTdHJ9YDsNCiAgICBzcGVlZEVsLnRleHRDb250ZW50ID0gYFNwZWVkOiAke2ZtdFNwZWVkKHByb2dyZXNzU3RhdGUuX3NwZWVkLmJwcyl9YDsNCiAgICBldGFFbC50ZXh0Q29udGVudCA9ICJFVEE6IDBzIjsNCiAgICBzZXRTdGF0dXMoIkRvbmUhIENsb3NpbmcuLi4iKTsNCg0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgd2luZG93LmNsb3NlKCk7DQogICAgICBwbGF5QnRuLmRpc2FibGVkID0gZmFsc2U7DQogICAgICBwbGF5QnRuLnN0eWxlLm9wYWNpdHkgPSAiMSI7DQogICAgICBwbGF5QnRuLnN0eWxlLmN1cnNvciA9ICJwb2ludGVyIjsNCiAgICAgIHNldFN0YXR1cygiRG9uZSEgKEJyb3dzZXIgYmxvY2tlZCBhdXRvLWNsb3NlIOKAlCB5b3UgY2FuIGNsb3NlIHRoaXMgdGFiLikiKTsNCiAgICB9LCA4MDApOw0KICB9DQoNCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgLy8gQnV0dG9uIGNsaWNrIGhhbmRsZXINCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgY29uc3Qgc2l0ZVVSTCA9ICJodHRwczovL2VkdWNhdGlvbi5jYWxjdWx1c3R1dG9yLnh5ei80MDRFWFAvc3JjL2NhbGN1bHVzL2RvY3MvIjsNCg0KICBwbGF5QnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKGUpID0+IHsNCiAgICBjb25zdCBmcmVzaCA9IGUuc2hpZnRLZXk7IC8vIGhvbGQgU2hpZnQgdG8gZm9yY2UgcmVkb3dubG9hZA0KICAgIGNyZWF0ZUJsb2JQYWdlKHNpdGVVUkwsIGZyZXNoKTsNCiAgfSk7DQp9KTsNCjwvc2NyaXB0Pg==